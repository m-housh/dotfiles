#!/usr/bin/env bash

set -e
set -o nounset
set -o pipefail

SCRIPTS=${SCRIPTS:-$HOME/.local/scripts}
THIS_FILE=${BASH_SOURCE[0]}
LOG_LABEL=$(basename "$THIS_FILE")
THIS=${THIS:-$LOG_LABEL}
LOG_FILE=${LOG_FILE:-"$LOG_LABEL.log"}

declare -a args
no_spin_flag="0"

# Logging utility function, use in place of echo.
log() {
	logging log --source "$THIS_FILE" "$@"
}

################################################################################
# MAIN
################################################################################

# Setup logging file and label.
source "$SCRIPTS/hypr/logging"
setup-logging "$LOG_FILE" "$LOG_LABEL"

while [[ $# -gt 0 ]]; do
	if [[ $1 == "--no-spin" ]]; then
		no_spin_flag="1"
	else
		args+=("$1")
	fi
	shift
done

script="$SCRIPTS/utils/shorten-url/create"

if [[ $no_spin_flag == "1" ]]; then
	bash -c "$script ${args[*]}"
else
	title="Generating short url..."
	gum spin --show-output --title="$title" -- bash -c "$script ${args[*]}"
fi
